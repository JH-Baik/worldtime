/*! The MIT License (MIT)
 * Copyright (c) 2022 Baik (https://worldtime247.com)
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

"use strict";class Canvas{"use strict";constructor(){this.canvasBg=document.querySelector(".card-img-overlay");this.ctxBg=this.canvasBg.getContext("2d");this.pixelRatio=window.devicePixelRatio>1?2:1;window.addEventListener("resize",this.resize.bind(this),false);this.resize();this.starInit={total:parseInt(this.stage.width/14),size:12,stsNear:parseInt(this.stage.width/18),star:[]};for(let i=0;i<this.starInit.total;i++)this.starInit.star[i]=new Star(this.stage,this.starInit.size);window.requestAnimationFrame(this.animate.bind(this))}resize(){this.stage={width:document.body.clientWidth,height:document.body.clientHeight};this.canvasBg.width=this.stage.width*this.pixelRatio;this.canvasBg.height=this.stage.height*this.pixelRatio;this.ctxBg.scale(this.pixelRatio,this.pixelRatio)}animate(){window.requestAnimationFrame(this.animate.bind(this));this.ctxBg.clearRect(0,0,this.stage.width,this.stage.height);bgAnimate(this.ctxBg,this.stage,this.starInit)}}function bgAnimate(ctxBg,stage,starInit){const star=starInit.star;const stsNear=starInit.stsNear;for(let i=0;i<star.length-1;i++){let ix=star[i].x;let iy=star[i].y;for(let j=i+1;j<star.length;j++){let jx=star[j].x;let jy=star[j].y;let dx=jx-ix;let dy=jy-iy;const distance=Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2));if(distance<star[i].starSize+star[j].starSize)star[i].collide(star[i],star[j],dx,dy,distance);if(distance<stsNear)star[i].drawStsNearLine(ctxBg,jx,jy,distance,stsNear)}star[i].draw(ctxBg,stage)}star[star.length-1].draw(ctxBg,stage)}class Star{constructor(stage,starSize){const speedMax=1;const speedMin=.2;const speedx=Math.random()*(speedMax-speedMin)+speedMin;const speedy=Math.random()*(speedMax-speedMin)+speedMin;const starSizeMin=5;const starSizeMax=starSize;this.starSize=Math.random()*(starSizeMax-starSizeMin)+starSizeMin;this.vx=Math.floor(Math.random()*10)%2?speedx:-speedx;this.vy=Math.floor(Math.random()*10)%2?speedy:-speedy;this.x=this.starSize+Math.random()*(stage.width-this.starSize*2);this.y=this.starSize+Math.random()*(stage.height-this.starSize*2);this.rgb=[,,,];for(let i=0;i<3;i++)this.rgb[i]=Math.floor(Math.random()*155)+101;this.rgb[Math.floor(Math.random()*3)]=0}draw(ctx,stage){this.x+=this.vx;this.y+=this.vy;this.bounceStage(stage);ctx.fillStyle=`rgba(${this.rgb[0]}, ${this.rgb[1]}, ${this.rgb[2]}, 0.4)`;ctx.beginPath();ctx.arc(this.x,this.y,this.starSize,0,Math.PI*2);ctx.fill()}drawStsNearLine(ctx,targetX,targetY,distance,stsNear){distance=(1-distance/stsNear)*.7;const THEME_COLOR=document.querySelector('[name="theme-color"]');ctx.strokeStyle=THEME_COLOR.content=="#000000"?`rgba(255, 255, 255, ${distance})`:`rgba(${this.rgb[0]}, ${this.rgb[1]}, ${this.rgb[2]}, ${distance})`;ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(this.x,this.y);ctx.lineTo(targetX,targetY);ctx.stroke()}bounceStage(stage){const minX=this.starSize;const maxX=stage.width-this.starSize;const minY=this.starSize;const maxY=stage.height-this.starSize;if(this.x<=minX||this.x>=maxX)this.vx=-this.vx;if(this.y<=minY||this.y>=maxY)this.vy=-this.vy;if(this.x-this.starSize<0)this.x=this.starSize;if(this.y-this.starSize<0)this.y=this.starSize;if(this.x+this.starSize>stage.width)this.x=stage.width-this.starSize;if(this.y+this.starSize>stage.height)this.y=stage.height-this.starSize}collide(b1,b2,dx,dy,d){let nx=dx/d;let ny=dy/d;let s=b1.starSize+b2.starSize-d;b1.x-=nx*s/2;b1.y-=ny*s/2;b2.x+=nx*s/2;b2.y+=ny*s/2;const k=-2*((b2.vx-b1.vx)*nx+(b2.vy-b1.vy)*ny)/(1/b1.starSize+1/b2.starSize);b1.vx-=k*nx/b1.starSize;b1.vy-=k*ny/b1.starSize;b2.vx+=k*nx/b2.starSize;b2.vy+=k*ny/b2.starSize}}window.onload=()=>{new Canvas};